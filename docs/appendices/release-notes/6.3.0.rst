.. _version_6.3.0:

==========================
Version 6.3.0 - Unreleased
==========================


.. comment 1. Remove the " - Unreleased" from the header above and adjust the ==
.. comment 2. Remove the NOTE below and replace with: "Released on 20XX-XX-XX."
.. comment    (without a NOTE entry, simply starting from col 1 of the line)
.. NOTE::

    In development. 6.3.0 isn't released yet. These are the release notes for
    the upcoming release.

.. NOTE::

    If you are upgrading a cluster, you must be running CrateDB 5.0.0 or higher
    before you upgrade to 6.3.0.

    We recommend that you upgrade to the latest 6.2 release before moving to
    6.3.0.

    A rolling upgrade from >= 6.2.0 to 6.3.0 is supported.
    Before upgrading, you should `back up your data`_.

.. WARNING::

    Tables that were created before CrateDB 5.x will not function with 6.x
    and must be recreated before moving to 6.x.x.

    You can recreate tables using ``COPY TO`` and ``COPY FROM`` or by
    `inserting the data into a new table`_.

.. _back up your data: https://cratedb.com/docs/crate/reference/en/latest/admin/snapshots.html
.. _inserting the data into a new table: https://cratedb.com/docs/crate/reference/en/latest/admin/system-information.html#tables-need-to-be-recreated

.. rubric:: Table of contents

.. contents::
   :local:

.. _version_6.3.0_breaking_changes:

Breaking Changes
================

- Removed the ``canned_acl`` setting for repositories of type ``s3`` and also
  removed the undocumented proxy settings.

- Removed the ``token_uri`` setting for repositories of type ``gcs``.

- Removed the following settings for repositories of type ``azure``:

  - ``location_mode``
  - ``secondary_endpoint``
  - ``endpoint_suffix``
  - ``timeout``
  - ``proxy_type``
  - ``proxy_host``
  - ``proxy_port``

Deprecations
============

None


Changes
=======

SQL Statements
--------------

None

SQL Standard and PostgreSQL Compatibility
-----------------------------------------

- Added the :ref:`information_schema.view_column_usage
  <information_schema_view_column_usage>` table.

- Added the :ref:`pg_sleep <scalar-pg_sleep>` function, which pauses a session.

- Added the :ref:`has_function_privileges <scalar-has-function-priv>` function,
  which checks whether a user has privileges to execute a function.

- Added support for ``SELECT`` statements without a column list (e.g.,
  ``SELECT FROM table``) to match PostgreSQL behavior. This enables
  compatibility with tools like TinyETL that use reflection queries such as
  ``SELECT EXISTS (SELECT FROM information_schema.tables WHERE table_name = $1)``.

Data Types
----------

None


Scalar and Aggregation Functions
--------------------------------

- `Dhruv Patel <https://github.com/DHRUV6029>`_ added support for ``interval``
  type to the :ref:`percentile <aggregation-percentile>` aggregation function.

- Added the :ref:`regexp_count <scalar-regexp_count>` scalar function to count
  regular expression matches, with optional ``start`` and ``flags`` arguments.

Performance and Resilience Improvements
---------------------------------------

- Added a :ref:`indices.breaker.policy` setting which can be set to either
  ``current`` (default - current behavior) or ``top_consumer`` (new experimental
  behavior). If set to ``top_consumer`` it changes the circuit breaking
  mechanism to abort the query consuming the most memory on the node where the
  circuit breaker was tripped instead of the query who tripped it.

- Changed the :ref:`swapping <alter_cluster_swap_table>` and
  :ref:`renaming <sql-alter-table-rename-to>` of tables to no longer re-allocate
  the shards of the swapped/renamed table, so that in-progress snapshots can
  finish successfully. Previously, the in-progress snapshots would fail and
  remain in ``PARTIAL`` state, with an ``ABORTED`` failure message showing in
  the :ref:`sys.snapshots <sys-snapshots>` system table.

Administration and Operations
-----------------------------

- Added a ``region`` option to repositories of type ``s3`` for compatibility
  with alternative s3 implementations like `Garage
  <https://garagehq.deuxfleurs.fr/>`_.

- Repositories of type ``s3`` now use path style access by default instead of
  virtual host style when building the URI.

Client interfaces
-----------------

None
