.. _version_5.8.4:

==========================
Version 5.8.4 - Unreleased
==========================


.. comment 1. Remove the " - Unreleased" from the header above and adjust the ==
.. comment 2. Remove the NOTE below and replace with: "Released on 20XX-XX-XX."
.. comment    (without a NOTE entry, simply starting from col 1 of the line)
.. NOTE::

    In development. 5.8.4 isn't released yet. These are the release notes for
    the upcoming release.

.. NOTE::
    If you are upgrading a cluster, you must be running CrateDB 4.0.2 or higher
    before you upgrade to 5.8.4.

    We recommend that you upgrade to the latest 5.7 release before moving to
    5.8.4.

    A rolling upgrade from 5.7.x to 5.8.4 is supported.

    Before upgrading, you should `back up your data`_.

.. WARNING::

    Tables that were created before CrateDB 4.x will not function with 5.x
    and must be recreated before moving to 5.x.x.

    You can recreate tables using ``COPY TO`` and ``COPY FROM`` or by
    `inserting the data into a new table`_.

.. _back up your data: https://crate.io/docs/crate/reference/en/latest/admin/snapshots.html

.. _inserting the data into a new table: https://crate.io/docs/crate/reference/en/latest/admin/system-information.html#tables-need-to-be-recreated

.. rubric:: Table of contents

.. contents::
   :local:

See the :ref:`version_5.8.0` release notes for a full list of changes in the
5.8 series.

Fixes
=====

- Fixed an issue that caused wrong results when ordering by an IP field or whehn
  comparing values of :ref:`IP type <type-ip>`, e.g.::

    SELECT * FROM tbl ORDER BY ip_col;
    SELECT ip_col > '11.22.33.44' FROM tbl;

- Fixed an issue that caused numeric values inside of ``OBJECT (IGNORED)``
  columns to be returned as text instead of number.

- Fixed an issue causing an object column definition with duplicate child
  column names to be accepted (last definition was used) instead of throwing an
  error. E.g.::

      CREATE TABLE tbl (obj OBJECT AS (a BOOLEAN, a INTEGER));

- Fixed an issue that caused filtering by :ref:`ANY <sql_any_array_comparison>`
  operator on an array typed column under an explicit cast to return invalid
  results.

- Fixed an issue that caused filtering by :ref:`ALL <all_array_comparison>`
  operator on :ref:`REAL <type-real>` array columns against literals to return
  invalid results.

- Fixed an issue that caused ``=`` or ``!=`` :ref:`ANY <sql_any_array_comparison>`
  operator to throw a ``ClassCastException`` when the right hand side argument
  was more than 1 dimensions higher than the left hand side argument.

- Fixed an issue that caused :ref:`ANY <sql_any_array_comparison>` operator to
  throw a ``ClassCastException`` when the arguments were nested arrays.

- Fixed an issue that caused cast to :ref:`NUMERIC <type-numeric>` to return
  incorrect results, with missing ``scale``. This issue has only affected
  multi-node cluster installations.

- Fixed an integer overflow issue when the total shards (shards and replicas)
  configured for a table are greater than ``Integer.MAX_VALUE``.

- Fixed an issue that caused ``=`` :ref:`ANY <sql_any_array_comparison>`
  operator to throw a ``ClassCastException`` when the right hand side argument
  was more than 1 dimensions higher than the left hand side argument.

- Fixed an issue that caused :ref:`in <sql_in_array_comparison>` operator with
  array typed column on left hand side of the arguments to return invalid
  results.

- Fixed an issue which may cause a ``EXPLAIN ANALYZE`` to throw exception due
  to internal concurrent unsafe access.
