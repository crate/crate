======================================
Backporting changes from Elasticsearch
======================================

With CrateDB 4.0.0, we integrated the Elasticsearch code and then pruned out
everything we don't use.

With CrateDB 4.2.0, we changed the module structure so that Elasticsearch and
CrateDB code is no longer split, but mixed within the same modules. The
majority is in the ``server`` component.

We still want to keep many of the components up-to-date, while other
components will converge more and more over time.

The areas where we want to stay close to upstream Elasticsearch are mostly:

- Engine
- Snapshotting
- Recovery
- Discovery and master election


Applied changesets
==================

Patches should be applied in order. A backport commit message should be
prefixed with ``bp:``. This allows us to verify later on whether a patch was
applied using something like this::

    sh$ git log --oneline --grep 'bp:'

If a patch is skipped, use the ``sp:`` prefix instead.

To see if there are new changes, you can use ``git log`` in the Elasticsearch
repository. For example::

    git log --oneline 4b16d50cd4b.. -- \
      server/src/main/java/org/elasticsearch/index/{engine,snapshots,store,translog,shard,seqno,mapper,codec}/ \
      server/src/main/java/org/elasticsearch/indices/recovery/ \
      server/src/main/java/org/elasticsearch/cluster/coordination \
      server/src/main/java/org/elasticsearch/cluster/routing \
      server/src/main/java/org/elasticsearch/transport \
      server/src/main/java/org/elasticsearch/gateway \
      server/src/main/java/org/elasticsearch/action/admin/cluster/health \
      server/src/main/java/org/elasticsearch/action/support/replication \
      server/src/main/java/org/elasticsearch/action/support/master


Here ``4b16d50cd4b`` is the starting point, it shows any changes since then
that affected files in the given folder.

(Note that there may be changes before ``4b16d50cd4b`` that are missing.)

We should eventually bump the reference point once all patches have been
applied to a certain point.

Below lists the changesets that we applied. This should be updated whenever a
backport is made. If a patch is skipped because it is not applicable, it
should be crossed out as well.

- ``x`` to mark applied patches
- ``s`` for skipped patches if they are not applicable (for example, if the
  functionality is not present in CrateDB)
- ``sn`` for skipped patches which have no effect because the related sources
  do not exist anymore
- ``sa`` for skipped patches which have been applied already
- ``su`` for skipped patches which are unrelated to CrateDB
- ``d`` marks a delayed patch - a non-trivial change we should apply that
  does not affect too any components, so delaying it doesn't make applying
  other patches more difficult

- [ ] 4dc833fa44e Add doc_count field mapper (#64503)
- [ ] c6b4b953f72 Enhance logging for timed out transport requests (#64433)
- [ ] a5168572d5b Collapse ParametrizedFieldMapper into FieldMapper (#64365)
- [ ] 0ed5174cb87 Make some Allocation Decider Code a Little More JIT Aware (#62275)
- [ ] df3c1d93283 Fix Store class comment typo. (#64325)
- [ ] ef4ea4ae103 Simplify ClusterStateUpdateTask Timeout Handling (#64117)
- [ ] 2186b75af9f Reduce usages of SearchContext#mapperService (#64250)
- [ ] eaac6496fc4 Fix #invariant Assertion in CacheFile (#64180)
- [ ] 3d19ce9b1dd Remove uid from Engine#Get constructor (#64119)
- [ ] 4191c72baf5 Distinguish between simple matches with and without the terms index (#63945)
- [ ] 266f52d9bad handle degenerated rectangles while indexing (#64122)
- [ ] b1d55e2ca8a SearchLookup to not require MapperService as a constructor argument (#64017)
- [ ] e85e54e0786 SimilarityService to not require the entire MapperService (#64032)
- [ ] bfaf3040c6e Convert geo field mappers to Parametrized form (#63836)
- [ ] 3efcc556935 Remove QueryShardContext#getMapperService (#63998)
- [ ] f2bcc775868 Drop boost from runtime distance feature query (#63949)
- [ ] 2406f59650b Minor FieldTypeLookup tweaks (#63944)
- [ ] b96f26eba20 Remove documentMapperParser method from MapperService (#63938)
- [ ] 04200361f4f Remove two redundant DocumentMapper methods (#63922)
- [ ] 1878cafdb92 DocumentMapperParser to no longer depend directly on MapperService (#63850)
- [ ] b79e6ae8f7b Convert parent-join mappers to parametrized form (#63878)
- [ ] 3d3837da141 Enable collapse on unsigned_long field (#63495)
- [ ] 5e559918612 Simplify DocumentParser handling (#63800)
- [ ] d126afb2c2d Remove direct dependency between ParserContext and MapperService (#63741)
- [ ] 305c36c920d Reduce ParseContext API surface (#63731)
- [ ] ea11c65e59d Convert FlatObjectFieldMapper to parametrized form (#63630)
- [ ] 6e0634a68a1 Prevent DocumentParser from relying on DocumentMapper at construction time (#63711)
- [ ] 65c983a745a Try to fix DiskThresholdDeciderIT (#63614)
- [ ] b796e342b6a Remove cyclic dependency between DocumentMapper and MapperService (#63639)
- [ ] f4adb2de387 Move geometry indexer to FieldMapper (#63618)
- [ ] 8b98af24b4f Remove generics from Mapper.Builder (#63623)
- [ ] 2b5e337e894 Check docs limit before indexing on primary (#63273)
- [ ] aefa31673a8 Revert "Recycle buffers used for cluster state publication (#63537)"
- [ ] f491422e1ed Ensure field types consistency on supporting text queries (#63487)
- [ ] faaf2e72bda Recycle buffers used for cluster state publication (#63537)
- [ ] 8f8d2d1b4ba [DOCS] Fix dup word in ShardRouting hashcode method. (#63452)
- [ ] 62857b49d1d Add support for missing value fetchers. (#63515)
- [ ] 2d1bf0c79ef Dry up TransportMasterNodeAction Usage (#63524)
- [ ] 4e740c2e4a5 Dry up AcknowledgedResponse Handling (#63335)
- [ ] dc5dbbbfe29 Flush translog writer before adding new operation (#63505)
- [ ] 8c56bbc3e6e Add factory methods for common value fetchers. (#63438)
- [ ] 80268f9bff6 TextSearchInfo should never get null analyzers (#63472)
- [ ] 3c752acfec9 Remove MapperService searchAnalyzer and searchQuoteAnalyzer (#63406)
- [ ] 675d9a12bd5 Make TextFieldMapper.FAST_PHRASE_SUFFIX private.
- [ ] 3a1a3642676 Move unmapped type handling to QueryShardContext (#63407)
- [ ] 80ff751e203 Selectively Add ClusterState Listeners Depending on Node Roles (#63223)
- [ ] dae6c367b51 SnapshotShardSizeInfo should prefer default value when provided (#63390)
- [ ] f4c85e4562c Convert TextFieldMapper to parametrized form (#63269)
- [ ] cc09b6b6a06 Make array value parsing flag more robust. (#63354)
- [ ] aa6c88f5664 Write translog operation bytes to byte stream (#63298)
- [ ] 2afec0d916c Determine shard size before allocating shards recovering from snapshots (#61906)
- [ ] 4ea642445b0 Retry CCR shard follow task when no seed node left (#63225)
- [ ] f1df20c6fa8 Do not block Translog add on file write (#63226)
- [ ] cf130f386e5 Replace some usages of QueryShardContext#getMapperService (#63239)
- [ ] 5871df4cfe5 Uniquely associate term with update task during election (#62212)
- [ ] ac93ca18190 Remove MapperService argument from IndexFieldData.Builder#build (#63197)
- [ ] ce649d07d77 Move FieldMapper#valueFetcher to MappedFieldType (#62974)
- [ ] 59a365d7034 Revert "Do not block Translog add on file write (#62513)"
- [ ] 13a073dca33 Do not block Translog add on file write (#62513)
- [ ] f5affcd34f6 Fix to actually throttle indexing when throttling is activated (#61768)
- [ ] 31a77869f11 Remove dependency of Geometry queries with mapped type names (#63077)
- [ ] 56d7f9152b0 Remove allocation id from engine (#62680)
- [ ] 981258b02b2 Remove TypeFieldMapper (#62838)
- [ ] be3357310a4 Convert all FieldMappers in mapper-extras to parametrized form (#62938)
- [ ] 2c43defacc9 Remove unused method from DocumentMapperParser (#62963)
- [ ] 34c79afd9d8 Refactor PointParser to not take FieldMapper as a parameter (#62950)
- [ ] 136940285a4 Implement Shard Snapshot Clone Logic (#62771)
- [ ] 118fa77a314 Add parameter update and conflict tests to MapperTestCase (#62828)
- [ ] 225e82f617f Remove some Outdated BwC Logic (#62072)
- [ ] b1d6d42a68f Remove mapping boost parameter entirely (#62639)
- [ ] daade441741 Share same existsQuery impl throughout mappers (#57607)
- [ ] 242083a36e0 Dedicated threadpool for system index writes (#61655)
- [ ] 39a6deccea9 Prioritise recovery of system index shards (#62640)
- [ ] 3a9b65733c5 Move stored flag from TextSearchInfo to MappedFieldType (#62717)
- [ ] e02555ce822 Cleanup Blobstore Repository Metadata Serialization (#62727)
- [ ] f34246b90b5 Optimize XContentParserUtils.ensureExpectedToken (#62691)
- [ ] 27ca0a8979d Convert ConstantKeywordFieldMapper to parametrized form (#62688)
- [ ] ea2dbd93b49 Add field type for version strings (#59773)
- [ ] db1a137927a Fix cluster health when closing (#61709)
- [ ] fe9145fa5e7 Search - add case insensitive flag for "term" family of queries (#61596)
- [ ] 2b0418df5f9 Emit deprecation warnings when boosts are defined in mappings (#62623)
- [ ] fe2ce8a3fd3 Also abort ongoing file restores when snapshot restore is aborted (#62441)
- [ ] 45e32e32b32 Tidy up fillInStackTrace implementations (#62555)
- [ ] 55294e5c424 Allow metadata fields in the _source (#61590)
- [ ] 7b50618d554 Allow empty null values for date and IP field mappers (#62487)
- [ ] 22d54656a2d Allocate new indices on "hot" or "content" tier depending on data stream inclusion (#62338)
- [ ] cdc175c1952 Suppress stack in VersionConflictEngineException (#62433)
- [ ] 1edb4f99191 Log if recovery affected by disconnect (#62437)
- [ ] cb5f1048544 Add WARN Logging on Slow Transport Message Handling (#62444)
- [ ] 115c48fddac Speed up merging when source is disabled. (#62443)
- [ ] 9a127adb4b1 Implement fields fetch for runtime fields (#61995)
- [ ] 9a9cb06916b Log WARN on Response Deserialization Failure (#62368)
- [ ] 0ec40a0abeb Save Some Allocations when Working with ClusterState (#62060)
- [ ] 4f2fa103c0d Remove Dead Variable in BlobStoreIndexShardSnapshots. (#62285)
- [ ] aefca5edd76 Shard Search Scroll failures consistency (#62061)
- [ ] 0684ebc4252 Remove Redundant Stream Wrapping from Compression (#62017)
- [ ] 3937b204a2f Convert RangeFieldMapper to parametrized form (#62058)
- [ ] 5f8c1f04845 Introduce integ tests for high disk watermark (#60460)
- [ ] b0510a36cd8 Fix null_value parsing for data_nanos field mapper (#61994)
- [ ] 98b5204bea5 Convert completion, binary, boolean tests to MapperTestCase (#62004)
- [ ] 38dc926e102 Ensure validation of the reader context is executed first (#61831)
- [ ] de56d715581 Remove unused deciders in BalancedShardsAllocator (#62026)
- [ ] 4978a79ce3a Simplify searchable snapshot shard allocation (#61911)
- [ ] 50a74f972a7 Improve error messages on bad [format] and [null_value] params for date mapper (#61932)
- [ ] e236054e095 upgrade to Lucene-8.7.0-snapshot-61ea26a (#61957)
- [ ] 60cda2a311f Merge branch 'master' into feature/runtime_fields
- [ ] 3269d1b4864 Add specific test for serializing all mapping parameter values (#61844)
- [ ] c9160612856 Merge branch 'master' into feature/runtime_fields
- [ ] 294e9cce212 Always include the matching node when resolving point in time  (#61658)
- [ ] c0802bbdddb Merge branch 'master' into feature/runtime_fields
- [ ] 1a31f9e332c Keep checkpoint file channel open across fsyncs (#61744)
- [ ] 03c3d6a339a Allow [null] values in [null_value] (#61798)
- [ ] d47d450baff Merge branch 'master' into feature/runtime_fields
- [ ] 28cec563b1a Allocate newly created indices on data_hot tier nodes (#61342)
- [ ] 0a3d3919a14 Merge branch 'master' into feature/runtime_fields
- [ ] 1f8dd4dd6a8 Use int for number of parts in blob store (#61618)
- [ ] 462e25f9bba Pass SearchLookup supplier through to fielddataBuilder (#61430)
- [ ] 7adf766fc48 Search - add case insensitive support for regex queries. (#59441)
- [ ] d070c99d4fe Some Optimizations around BytesArray (#61183)
- [ ] 879279c9b46 Introduce point in time APIs in x-pack basic (#61062)
- [ ] e2dd0bde26e Merge branch 'master' into feature/runtime_fields
- [ ] c531574407c Speed up Compression Logic by Pooling Resources (#61358)
- [ ] 34b4acc8ad9 Migrate server mapper tests to new MapperTestCase (#61378)
- [ ] 6a9dde599f5 Merge branch 'master' into feature/runtime_fields
- [ ] 051e79d27d5 Stop opening PING conns to remote clusters (#61408)
- [ ] 717db9c4ea7 Optimize a few Spots on IO Loop (#60865)
- [ ] dbd4fd02545 Convert NumberFieldMapper to parametrized form (#61092)
- [ ] 5457b343438 Correct how field retrieval handles multifields and copy_to. (#61309)
- [x] 98213df9462 Report more details of unobtainable ShardLock (#61255)
- [ ] 99c885e5dad Merge branch 'master' into feature/runtime_fields
- [ ] 3b442743731 Improve 'ignore_malformed' handling for dates (#60211)
- [ ] d9060ae4eee Reduce allocations when persisting cluster state (#61159)
- [ ] 8e8d6f2ca2f Better error msg when CCS request on node without remote role (#60351)
- [ ] 0ba66dc1277 Fail invalid incremental cluster state writes (#61030)
- [ ] 0b517ddca6f Provide option to allow writes when master is down (#60605)
- [ ] 2ef5902bfb0 Convert KeywordFieldMapper to parametrized form (#60645)
- [ ] b2a9466ab0e Handle nested arrays in field retrieval. (#60940)
- [ ] fd8b557935c Merge branch 'master' into feature/runtime_fields
- [ ] 9b9aa5fa451 Add the ScriptService to the field parser config (#60933)
- [ ] 8c51fc7e2d3 System index reads in separate threadpool (#57936)
- [ ] 3a81b110739 Make MetadataFieldMapper extend ParametrizedFieldMapper (#59847)
- [ ] 19eb922d9fd Remove join timeout (#60873)
- [ ] 0e3f7c2fb27 Cut over IPFieldMapper to parametrized form (#60602)
- [ ] 3a803c85a41 Fix testRerouteOccursOnDiskPassingHighWatermark (#60869)
- [ ] 5e3ea6eb11c Merge branch 'master' into feature/runtime_fields
- [ ] 04ca1913c57 Move distance_feature query building into MFT (#60614)
- [ ] e98dfcc8893 Implement runtime script ips (#60533)
- [ ] 45402118936 Merge branch 'master' into feature/runtime_fields
- [ ] fe780aae0bc Propagate forceExecution when acquiring permit (#60634)
- [ ] ec175d16537 Improve some BytesStreamOutput Usage (#60730)
- [ ] 9b71cdea7e3 Add recovery state tracking for Searchable Snapshots (#60505)
- [ ] 77d3f33a175 Fail searchable snapshot shards on invalid license (#60722)
- [ ] 00229072fac Optimize CS Persistence Stream Use (#60643)
- [ ] d6fc439fef0 Move mapper validation to the mappers themselves (#60072)
- [ ] 598ed7222a3 Ignore shutdown when retrying recoveries (#60586)
- [ ] 955b363263a [DOCS] Fix typo in gateway allocator comment (#60563)
- [ ] 85a30c06286 Improve deserialization failure logging (#60577)
- [ ] 28f6fd0c65a Merge branch 'master' into feature/runtime_fields
- [ ] f3403faf127 Remove IndexFieldData#clear since it is unused. (#60475)
- [ ] 35ca3804e7a Add runtime_script date field (#60092)
- [ ] 944a6c243c2 Allows nanosecond resolution in search_after (#60328)
- [ ] cec7c136cdc Merge branch 'master' into feature/runtime_fields
- [ ] 48981b40424 Fix up BWC following backport of #60297 (#60313)
- [ ] 5d0f8e35656 Cleanup and optimize More Serialization Spots (#59959)
- [ ] e3bbb3bed4e Merge branch 'master' into feature/runtime_fields
- [ ] 940d6181863 Log and track open/close of transport connections (#60297)
- [ ] b2b01dc6dee Properly document keepalive and other tcp options (#60216)
- [ ] 8a89d95372a Add search `fields` parameter to support high-level field retrieval. (#60100)
- [ ] 9026770f2fb Pass a SearchLookup supplier through to fielddataBuilder (#60224)
- [ ] d8b9801b651 [DOCS] Fix typo in adapt auto expand replica comments (#60187)
- [ ] bceb41ac889 Merge branch 'master' into feature/runtime_fields
- [ ] 423bcd3c14d Remove typename validation (typename is always ) (#60133)
- [ ] ad3fb94077b Merge branch 'master' into feature/runtime_fields
- [ ] c1274a4caa9 Remove node-level canAllocate override (#59389)
- [ ] 5fcef9a9009 Merge branch 'master' into feature/runtime_fields
- [ ] 198b2d6654f ParametrizedFieldMapper to run validators against default value (#60042)
- [ ] 8bddd840fa3 Add double script fields (#59933)
- [ ] b81db2a39f8 Merge branch 'master' into feature/runtime_fields
- [ ] 4ef33425d25 Wrap up building parametrized TypeParsers (#59977)
- [ ] 1cf9eac4045 Tweak toXContent implementation of ParametrizedFieldMapper (#59968)
- [ ] 98698f569d2 Drop some params from IndexFieldData.Builder (#59934)
- [ ] c61dc11bf49 Deprecate camel case date format (#59555)
- [ ] d4e315531ab Simplify structure for parsing points. (#59815)
- [ ] 38af183a3f9 Cleanup and Optimize Multiple Serialization Spots (#59626)
- [ ] 0589d2e0070 Remaining queries for long script field (#59816)
- [ ] 2c5c478875e Merge branch 'master' into feature/runtime_fields
- [ ] c8b5af91fc2 Add long flavored script field (#59721)
- [ ] 6130ecc1731 Small cleanup for IndexFieldData (#59724)
- [ ] 4db094c0082 Remove dangling index auto import functionality (#59698)
- [ ] 42377c77299 Shortcut mapping update if the incoming mapping version is the same as the current mapping version (#59517)
- [ ] b9854165f34 Fix merge error
- [ ] bf12ac13333 Convert DateFieldMapper to parametrized format (#59429)
- [ ] 8bcca0c7a1d Preserve old serialization for CompletionFieldMapper (#59550)
- [ ] 678ae31d1d6 Fix compilation in Eclipse (#59675)
- [ ] fd88ab13419 Correct type parametrization in geo mappers. (#59583)
- [ ] aa14860597e Separate coordinating and primary bytes in stats (#59487)
- [ ] b083bafa786 Make MappedFieldType#meta final (#59383)
- [ ] dc91a300700 Move getPointReaderOrNull into AggregatorBase (#58769)
- [ ] b87bb86d88d Adding indexing pressure stats to node stats API (#59247)
- [ ] 24786ac71b8 Migrate CompletionFieldMapper to parametrized format (#59291)
- [ ] 33630489dbf Continue to accept unused 'universal' params in <8.0 indexes (#59381)
- [ ] 40b9fd49e02 Make data streams a basic licensed feature. (#59293)
- [ ] 4c1b081e270 Fix estimate size of translog operations (#59206)
- [ ] 62f51eb9aec MappedFieldType no longer requires equals/hashCode/clone (#59212)
- [ ] 650f20eb0d8 Default gateway.auto_import_dangling_indices to false (#58898)
- [ ] 5e73d7133c9 Fix node health-check-related test failures (#59277)
- [ ] 219b7dbd12f Add declarative parameters to FieldMappers (#58663)
- [ ] 5688e0e4900 Do not release safe commit with CancellableThreads (#59182)
- [ ] 611fb03f628 Implement rejections in `WriteMemoryLimits` (#58885)
- [ ] cb6b05d12b9 Fix the timestamp field of a data stream to @timestamp (#59076)
- [ ] 961db311f0e Sending operations concurrently in peer recovery (#58018)
- [ ] 31a569a60a2 Remove uid from translog delete operation (#59101)
- [ ] ef4cdb0303f Remove nodes with read-only filesystems (#52680)
- [ ] 2e3f3c0fce8 Extract recovery files details to its own class (#59039)
- [ ] f6cc374e132 Remove IndexShardRoutingTable#primaryAsList (#59044)
- [ ] 90e72a4194e Avoid flipping translog header version (#58866)
- [ ] 922c8672cc7 Fix Two Common Zero Len Array Instantiations (#58944)
- [ ] e592a9a5e72 Add include_data_streams flag for authorization (#58154)
- [ ] 52ff121fcfc Re-enable support for array-valued geo_shape fields. (#58786)
- [ ] 673444000e3 Percolator keyword fields should not store norms (#58899)
- [ ] 001b3fb4406 Add data stream timestamp validation via metadata field mapper (#58582)
- [ ] 69c7e73b665 Drop rewriting in date_histogram (#57836)
- [ ] 9a36d6e5bde Count coordinating and primary bytes as write bytes (#58575)
- [ ] 3944066e992 Move MappedFieldType#getSearchAnalyzer and #getSearchQuoteAnalyzer to TextSearchInfo (#58639)
- [ ] dcd723a6b19 Enable BWC tests after backport of #58029 (#58815)
- [ ] ee79ae072ba Week based parsing for ingest date processor (#58597)
- [ ] 83d6589b2ae Account for remaining recovery in disk allocator (#58029)
- [ ] 118521d0223 Account for recovery throttling when restoring snapshot (#58658)
- [ ] 676893a2632 Merge mappings for composable index templates (#58521)
- [ ] 9bef31ccd3a Do not create two loggers for DeprecationLogger (#58435)
- [ ] 7d64b71a05d Simplify Serialization of ForceMergeRequest (#58470)
- [ ] 3d58f3a1f6b [Docs] Fix return tuple element order (#58463)
- [ ] c16a4553cb2 Add memory tracking to queued write operations (#57573)
- [ ] a914d84429a Introduce node.roles setting (#54998)
- [ ] cdc1be144bf Field capabilities - make `keyword` a family of field types (#58315)
- [ ] 83ce7a96915 Move MappedFieldType.similarity() to TextSearchInfo (#58439)
- [ ] d747c1bf7a8 [DOCS] Fix typo in RoutingNode comment (#58079)
- [ ] 57316e26af6 Add text search information to MappedFieldType (#58230)
- [ ] 63922dfcbdb Save Shard ID Serializations in Bulk Requests (#56209)
- [ ] b8db2da0963 Remove anonymous PublicationContext implementation (#58405)
- [ ] 3cbe56463ed Make FieldTypeLookup immutable (#58162)
- [ ] 409306e01db Correct default formatting of binary fields (#58338)
- [ ] 708f6bf8795 Add serialization test for FieldMappers when include_defaults=true (#58235)
- [ ] 09ff747fe74 Remove Settings parameter from FieldMapper base class (#58237)
- [ ] 0c3dd945338 Add new extensions for Lucene86 points codec to FsDirectoryFactory (#58226)
- [ ] ebe89518795 Implement dangling indices API (#50920)
- [ ] 1d62d7d663f Don't log on RetentionLeaseSync error handler (#58098)
- [ ] c7cbf80dfc9 Remove needless termsQuery implementation from StringFieldType (#57609)
- [ ] bf910e91328 Fix recovery stage transition with sync_id (#57754)
- [ ] 3b696828ada MappedFieldType should not extend FieldType (#57666)
- [ ] 79227e1413c Fix Running TranslogOps on CS Thread (#58056)
- [ ] 4263de790aa Hide AlreadyClosedException on IndexCommit release (#57986)
- [ ] e19a82d7628 Update to lucene snapshot e7c625430ed (#57981)
- [ ] e1065b24142 Fix Remote Recovery Being Retried for Removed Nodes (#57608)
- [ ] db584c07a2b Fix stalled send translog ops request (#57859)
- [ ] 8c8253d251f Minor Cleanup Dead Code Snapshotting (#57716)
- [ ] c095a3a2478 Assert on request headers only (#57792)
- [ ] 5221970b2ab Use clean thread context for transport and applier service (#57792)
- [ ] 1423a0c42eb Fix translog ops action name in channel listener (#57854)
- [ ] 807e0759ab3 Update version peer recovery constants to 7_9 (#57829)
- [ ] b68bd78a53a Refactor how to determine if a field is metafield (#57378)
- [ ] 3f072aabcb9 Restore ThreadContext after Serializing OutboundMessage (#57659)
- [ ] d81ea8e7c73 Timeout health API on busy master (#57587)
- [ ] 88a2aeb8cf6 Remove the 'array value parser' marker interface. (#57571)
- [ ] 0a23487e73e IndexFieldData should hold the ValuesSourceType (#57373)
- [ ] 6477924c262 Store parsed mapping settings in IndexSettings (#57492)
- [ ] 4d6dc51c729 Header warning logging refactoring (#55941)
- [ ] 2ef82cd7f95 Fix Local Translog Recovery not Updating Safe Commit in Edge Case (#57350)
- [ ] 9d07229879d Change cluster info actions to be able to resolve data streams. (#56878)
- [ ] 99871b18d64 Catch InputCoercionException thrown by Jackson parser (#57287)
- [ ] 86b64e4c39e Remove unused logic from FieldNamesFieldMapper. (#56834)
- [ ] 579ce2f99cb Reestablish peer recovery after network errors (#55274)
- [ ] fed71fbd669 Remove Mapper.updateFieldType() (#56986)
- [ ] 2787eadb1ac Flatten ReleaseableBytesReference Object Trees (#57092)
- [ ] ee56a3644f4 Add History UUID Index Setting (#56930)
- [ ] 2a8b5787466 Serialize Outbound Messages on IO Threads (#56961)
- [ ] 65f3cb1f1f6 Close channel on handshake error with old version (#56989)
- [ ] 9a49075d0c9 Simplify range query methods for range types. (#56976)
- [ ] f82d74b5017 Move merge compatibility logic from MappedFieldType to FieldMapper (#56915)
- [ ] e686d304f48 Remove Dead Conditional from RoutingTable (#56870)
- [ ] 0cc2345f98d Simplify generics on Mapper.Builder (#56747)
- [ ] 595ce8b5e37 Cancel task and descendants on channel disconnects (#56620)
- [ ] 9c7e0d4ddb2 Prevent connection races in testEnsureWeReconnect (#56654)
- [ ] 7b34e22890e Use index sort range query when possible. (#56657)
- [ ] 954afd94fe8 Clean up DocValuesIndexFieldData (#56372)
- [ ] e62fb090fa5 upgrade to Lucene 8.6.0 snapshot (#56175)
- [ ] 4de4c14b5b9 Save Bounds Checks in BytesReference (#56577)
- [ ] a01d2bd24b0 [Geo] Refactor Point Field Mappers (#56060)
- [ ] fa535d08b50 Use CollectionUtils.isEmpty where appropriate (#55910)
- [ ] 77aa2362bbb Allow a number of broadcast transport actions to resolve data streams (#55726)
- [ ] 0ae0e700397 Allow cluster health api to resolve data streams (#56413)
- [ ] e1dbe2606ce Use snapshot information to build searchable snapshot store MetadataSnapshot (#56289)
- [ ] a95586773fd Improve logging around SniffConnectionStrategy (#56292)
- [ ] 601617a3fc0 Avoid copying file chunks in peer covery (#56072)
- [ ] 77ac5d805bb Make sure to use ParseContext.Document#addAll when possible.
- [ ] 378e36c26d1 Move includeDataStream flag from IndicesOptions to IndexNameExpressionResolver.Context (#56034)
- [ ] 7a5d18ddc37 Simplify signature of FieldMapper#parseCreateField. (#56066)
- [ ] bb04fbcd969 For constant_keyword, make sure exists query handles missing values. (#55757)
- [ ] b2b32d7cf85 Retry failed replication due to transient errors (#55633)
- [ ] b04a6f4766b Improve same-shard allocation explanations (#56010)
- [x] a508d3303d5 Ensure no circular reference in translog tragic exception (#55959)
- [ ] b22a5288f57 Fix NullPointer when message shortcircuited (#55882)
- [ ] 8200be989a8 Avoid double-recovery when state recovery delayed
- [ ] 8d276043667 Improve RemoteConnectionManager consistency (#55759)
- [ ] d7bc3ddf056 Fix Leaking Listener When Closing NodeClient (#55676)
- [ ] 0bd28aed4e8 Disk decider respect watermarks for single data node (#55805)
- [ ] 8521ae52b1b Remove TODO around aggregating on _index.
- [ ] db288a29ec9 Ignore closed exception on refresh pending location listener (#55799)
- [ ] b2a15c62fb2 Return true for can_match on idle search shards (#55428)
- [ ] 43b8327b6e0 [Geo] fix GeoShapeWithDocValuesFieldMapper.doXContentBody
- [ ] eb0b2c8f699 Refactor Spatial Field Mappers (#55621)
- [ ] 18043965823 Fix Broken ExistingStoreRecoverySource Deserialization (#55657)
- [ ] 4ed0dc8703f Retry failed peer recovery due to transient errors (#55353)
- [ ] d6fb306c961 Allow searching of snapshot taken while indexing (#55511)
- [ ] 05066aecf07 Add Bulk stats track the bulk per shard (#52208)
- [ ] c2df6f911d1 Ensure not to open directory reader on transport thread (#55419)
- [ ] 5216bd273a7 Retry follow task when remote connection queue full (#55314)
- [ ] fada09a1326 Make data streams in APIs resolvable. (#54726)
- [ ] b78dfb07ae1 Add geo_shape mapper supporting doc-values in Spatial Plugin (#55037)
- [ ] 5c66caf21a9 Fix updating include_in_parent/include_in_root of nested field throws… (#54386)
- [ ] 8638d08ebf6 Always use deprecateAndMaybeLog for deprecation warnings (#55115)
- [ ] ce607f88cf4 Remove version guards in JoinRequest serialization (#55296)
- [ ] 6b299d4e227 Voting config exclusions should work with absent nodes (#50836)
- [ ] b54ee89511d Introduce mechanism to stub request handling (#55091)
- [ ] 633790fa99f NodeInfo response should use a collection rather than fields (#54460)
- [ ] dd72ccbe277 Fail sniff  process if no connections opened (#54934)
- [ ] 4f0ccd3c254 Implement transport circuit breaking in aggregator (#54610)
- [ ] 3bfcc60cce6 Update translog policy before the next safe commit (#54839)
- [ ] f6feb6c2c84 Merge feature/searchable-snapshots branch into master (#54803)
- [ ] 2c5951ae1cf Use TransportChannel in TransportHandshaker (#54684)
- [ ] 150065182eb Disallow changing 'enabled' on the root mapper. (#54463)
- [ ] 139931af5b2 Revert sending cluster name and node in handshake (#54661)
- [ ] ee3d40320aa Broadcast cancellation to only nodes have outstanding child tasks (#54312)
- [ ] 07b8b073b34 Resolve some coordination-layer TODOs (#54511)
- [ ] 95a7eed9aa3 Rename MetaData to Metadata in all of the places (#54519)
- [ ] 2073d8c4b90 Use VotingConfiguration#of where possible (#54507)
- [ ] 9d861bff71e Move network stats marking into InboundPipeline (#54393)
- [ ] 6fcb51dafcd Fix issue with pipeline releasing bytes early (#54458)
- [ ] 4164f1e9f81 Remove Unused BaseNodeRequest (#54323)
- [ ] 42150d36740 Move transport decoding and aggregation to server (#48263)
- [ ] a90c1de8745 Add ValuesSource Registry and associated logic (#54281)
- [ ] e9bc3e8234b Disallow negative TimeValues (#53913)
- [ ] 513985e0722 Remove the cluster.remote.connect setting (#54175)
- [ ] f301f499184 Avoid I/O operations when rewriting shard search request (#54044)
- [ ] 1fc0432b244 Introduce formal role for remote cluster client (#53924)
- [ ] 2f9e5fa9cea Allow proxy mode server name to be updated (#54107)
- [ ] 895b1605f8e Use special XContent registry for node tool (#54050)
- [ ] 2537e02a7db Wildcard field - add normalizer support (#53851)
- [ ] c5d073185e8 Give helpful message on remote connections disabled (#53690)
- [ ] ec4c699defb Prevent SigTerms/SigText from running on fields they do not support (#52851)
- [ ] 8264bdd36a2 Revert "Introduce system index APIs for Kibana (#52385)" (#53912)
- [ ] 87c910b36f8 Better Incrementality for Snapshots of Unchanged Shards (#52182)
- [ ] 856721c574d Handle properly indexing rectangles that crosses the dateline (#53810)
- [ ] 290d58b1b05 Remove unnecessary fromValue method for ClusterHealthStatus (#53893)
- [ ] f3243949d73 Describe STALE_STATE_CONFIG in ClusterFormationFH (#53878)
- [ ] 4a663971d5f Use consistent threadpools in CoordinatorTests (#53868)
- [ ] 2794ab79753 Execute retention lease syncs under system context (#53838)
- [ ] 76cd6385cef Revert "Apply cluster states in system context (#53785)" (#53842)
- [ ] c1dc5238da1 Apply cluster states in system context (#53785)
- [ ] 6eb698bc6d3 Add support for distance queries on geo_shape queries (#53466)
- [ ] ca7a135e089 Improve performance of shards limits decider (#53577)
- [ ] d1cbdfb7530 Geo shape query vs geo point (#52382)
- [ ] e1096b9457c Restore off-heap loading for term dictionary in ReadOnlyEngine (#53713)
- [ ] fe5092ae245 Deprecate delaying state recovery for master nodes (#53646)
- [ ] 3e607d9e93c Rename AtomicFieldData to LeafFieldData (#53554)
- [ ] 41e3b4aa905 Invoke response handler on failure to send (#53631)
- [ ] 87dc720daca Update server name serialization version
- [ ] 2abf40a6b61 Add server name to remote info API (#53634)
- [ ] 01eee1a97f9 Highlighters skip ignored keyword values (#53408)
- [ ] fa6d5158930 Remove extra code in allocation commands parsing (#53579)
- [ ] 8ccdaa3a354 Align remote info api with new settings (#53441)
- [ ] 1fc3fe3d32f Fix Term Vectors with artificial docs and keyword fields (#53504)
- [ ] facd525b0a3 Mask wildcard query special characters on keyword queries (#53127)
- [ ] 6de1db8b73e Re-enable BWC tests after backport of #53338 (#53389)
- [ ] 9dcd88ee1e8 Allow joining node to trigger term bump (#53338)
- [ ] 352e59cc56f Fix doc_stats and segment_stats of ReadOnlyEngine (#53345)
- [ ] 713e931df4c Record Force Merges in Live Commit Data (#52694)
- [ ] a63232d2bc6 Fix date_nanos in composite aggs (#53315)
- [ ] 5d716bc16ce Upgrade to final lucene 8.5.0 snapshot (#53293)
- [ ] 111d7c2bf70 Remove some unneeded eclipse workarounds (#47987)
- [ ] abdaf3ab2c5 Use given executor for global checkpoint listener (#53260)
- [ ] 04930e990aa Notify refresh listeners on the calling thread (#53259)
- [ ] 806046339d2 Early return if no global checkpoint listeners (#53036)
- [ ] 4c0e8f12cbc Introduce system index APIs for Kibana (#52385)
- [ ] f4223b6a8fa Add size support to `top_metrics` (#52662)
- [ ] 31b29875c9d Add validation for dynamic templates (#51233)
- [ ] 4943bc0cd39 HybridDirectory should mmap postings. (#52641)
- [ ] a3a98c7003e Cache completion stats between refreshes (#51991)
- [ ] c5ed349382c Fix RemoteConnectionManager size() method (#52823)
- [ ] 94f5accfed8 Remove seeds depedency for remote cluster settings (#52796)
- [ ] 8830eb6b9a8 Generalize how queries on `_index` are handled at rewrite time (#52486)
- [ ] 18f5e5a3709 Update RemoteConnectionInfo version constants (#52780)
- [ ] a789f74b769 Fix incorrect indentation in TextFieldMapper.
- [ ] 7684ae882c8 Improve the error message when loading text fielddata. (#52753)
- [ ] bdb6c350f56 Clarify when shard iterators get sorted (#52633)
- [ ] 2a95ecb7c18 Don't index ranges including NOW in percolator (#52748)
- [ ] c276f6db291 Remove TODOs from MetaStateService (#52646)
- [ ] f05b831e43a Comprehensively test supported/unsupported field type:agg combinations (#52493)
- [ ] 16af0472a98 Separate translog from index deletion conditions (#52556)
- [ ] cbd224d0701 Upgrade Lucene 8.5 to latest snapshot (#52520)
- [ ] b176cca607e Fix synchronization in ByteSizeCachingDirectory (#52512)
- [ ] f3b5bd951b0 Move the terms index of `_id` off-heap. (#52405)
- [ ] 2f6ac68fd82 Deciders should not by default collect yes'es (#52438)
- [ ] 30316d6d640 Refactor GeoShapeIndexer by extracting polygon / line decomposers (#52422)
- [ ] 403d1ff7008 Optimize FilterStreamInput for Network Reads (#52395)
- [ ] a9afdd7611b Remove fixed_auto_queue_size threadpool type (#52280)
- [ ] 5b2266601be Implement top_metrics agg (#51155)
- [ ] a8b39ed842c Add a cluster setting to disallow expensive queries (#51385)
- [ ] da2b67d6e5b Fix a DST error in date_histogram (#52016)
- [ ] a304d9a6564 Ignore timeouts with single-node discovery (#52159)
- [ ] 2c305810cc6 In FieldTypeLookup, factor out flat object field logic. (#52091)
- [ ] eb56c271b4c Don't Upload Redundant Shard Files (#51729)
- [ ] ebc46814732 Use local checkpoint to calculate min translog gen for recovery (#51905)
- [ ] cb34d1ad2e3 Re-enable BwC Tests (#52110)
- [ ] 19174d6ef0d Cleanup some Dead Code in o.e.index.store (#52045)
- [ ] f38a4f5b9ad Remove references to mapping type in FieldTypeLookup. (#52026)
- [ ] e0b3ea04167 Rename MapperService#fullName to fieldType. (#52025)
- [ ] e79e6d9c1d0 Remove Redundant Loading of RepositoryData during Restore (#51977)
- [ ] 3c9996404f4 Remove the index.mapper.dynamic setting. (#51718)
- [ ] 26b9cf787df Add Trace Logging of REST Requests (#51684)
- [ ] eb69c6fe7cf Always rewrite search shard request outside of the search thread pool (#51708)
- [ ] 7e85fc454eb Throw better exception on wrong `dynamic_templates` syntax (#51783)
- [ ] 84dd9dc9c03 Add host address to BindTransportException message (#51269)
- [ ] bf317e8c4eb Remove comparison to true for booleans (#51723)
- [ ] 9dbd9ba757f Extract a ConnectionManager interface (#51722)
- [ ] 635fe347b7e Simplify rebalancer's weight function (#51632)
- [ ] 7cec5f93bee Make `date_range` query rounding consistent with `date` (#50237)
- [ ] 336a3958aa6 Log exceptions in TcpTransport at DEBUG level (#51612)
- [ ] c117c0cf0a2 Password-protected Keystore Feature Branch PR (#51123)
- [ ] 0c87892b3db Remove sync flush logic in Engine (#51450)
- [ ] b034d1e2ef8 Remove translog retention policy (#51417)
- [ ] db480292eeb Fix TransportMasterNodeAction not Retrying NodeClosedException (#51325)
- [ ] 80cacc617f2 Enable operation-based recoveries for old copies (#51380)
- [ ] 5132715bc10 Do not wrap soft-deletes reader for segment stats (#51331)
- [ ] 151148622cb Exclude nested documents in LuceneChangesSnapshot (#51279)
- [ ] 1dc9dd42235 Add NestedPathFieldMapper to store nested path information (#51100)
- [ ] fac1247e16f Fix Overly Optimistic Request Deduplication (#51270)
- [ ] 573c7ddab18 Remove fieldMapper parameter from MetadataFieldMapper.TypeParser#getDefault() (#51219)
- [ ] 6e2f7b4b084 Use Lucene index in peer recovery and resync (#51189)
- [ ] c8e9f57348f Account soft-deletes in FrozenEngine (#51192)
- [ ] 3d796248437 Revert "Don't use user-supplied type when building DocumentMapper (#50960)" (#51214)
- [ ] 173c3bdac41 Introduce hidden indices (#50452)
- [ ] 9bb7d21c0b0 Remove the AllFieldMapper from master (#51106)
- [ ] 09b46c86463 Goodbye and thank you synced flush! (#50882)
- [ ] 0e0f900d181 Tweak formatter config for long generic lines (#50909)
- [ ] 7cd4b73b098 Fix compilation for #50813
- [ ] d94b81e8b0e Remove custom metadata tool (#50813)
- [ ] e349c5eec09 Track Snapshot Version in RepositoryData (#50930)
- [ ] b332c8b0f5d Revert "Update handshake response version constants to 7.6 (#48917)" (#50945)
- [ ] 774bfb5e223 Don't use user-supplied type when building DocumentMapper (#50960)
- [ ] b146740e052 Fix queuing in AsyncLucenePersistedState (#50958)
- [ ] 5736dfb8c31 Warn on slow metadata performance (#50956)
- [ ] d1deeaeb74c Allow proxy mode server name to be configured (#50774)
- [ ] d9528406bf3 Use default profile for remote connections (#50828)
- [ ] a0513217dba Move metadata storage to Lucene (#50907)
- [ ] 0510af87868 Do not force refresh when write indexing buffer (#50769)
- [ ] 40801af8840 Import replicated closed dangling indices (#50649)
- [ ] fdd413370ef Deleted docs disregarded for if_seq_no check (#50526)
- [ ] 4c1f1b2acab Declare remaining parsers `final` (#50571)
- [x] 77fd51f30ba Remove some Dead Code from Discovery Plugins (#50592)
- [x] 671fefaf59e Enhance TransportReplicationAction assertions (#49081)
- [d] 424ed93e38b Always use soft-deletes in InternalEngine (#50415)
- [x] d02afccd983 Ensure relocating shards establish peer recovery retention leases (#50486)
- [sa] 50bd5842c3c Fix testCancelRecoveryDuringPhase1 (#50449)
- [su] 5e0030e1306 Adjust BWC for peer recovery retention leases (#50351)
- [d] a48d19d73a8 Add remote info to the HLRC (#50482)
- [d] b7ac7324d23 Revert "Add remote info to the HLRC (#49657)"
- [sn] f4989c54c45 Revert "serialize initial_connect_timeout as xcontent correctly"
- [sn] ae64eaabdae serialize initial_connect_timeout as xcontent correctly
- [d] fa1a7c57b8e Add remote info to the HLRC (#49657)
- [x] cec6678587e Use peer recovery retention leases for indices without soft-deletes (#50351)
- [sn] 3b8f5d9ea18 Modify proxy mode to support a single address (#50391)
- [sn] 342a2920a96 Rename the remote connection mode simple to proxy (#50291)
- [d] 2d627ba7574 Add per-field metadata. (#49419)
- [sn] 012746dd816 Send hostname in SNI header in simple remote mode (#50247)
- [su] ee92253f775 Adapt BWC after backporting #50214
- [x] 74ff50f814a Omit loading IndexMetaData when inspecting shards (#50214)
- [sn] 7b863dc25b3 Recovery buffer size 16B smaller (#50100)
- [x] 972b81f8a9d Account trimAboveSeqNo in committed translog generation (#50205)
- [sn] e0e7f1f89a4 Disk threshold decider is enabled by default (#50222)
- [su] 34f83904cc8 Adjust bwc for #48430
- [x] b9fbc8dc748 Migrate peer recovery from translog to retention lease (#49448)
- [sn] 0cedb9e2517 Update remote cluster stats to support simple mode (#49961)
- [d] 70af176dea3 Improve DateFieldMapper `ignore_malformed` handling (#50090)
- [su] c5ecbee224f Update TcpHeader version constant for backport (#50086)
- [su] 1329acc094c Upgrade to lucene 8.4.0-snapshot-662c455. (#50016)
- [sn] 0062d5f301a [DOCS] Remove shadow replica reference (#50029)
- [x] 678aeb747ea Make elasticsearch-node tools custom metadata-aware (#48390)
- [x] 87517d96f62 Enable dependent settings values to be validated (#49942)
- [s] fc3454b10bb Randomly run CCR tests with _source disabled (#49922)
- [s] 7f1e1c51a47 Cleanup some in o.e.transport (#49901)
- [x] 8c2dda90c0f Add int indicating size of transport header (#48884)
- [s] fb293adb0f5 Ensure remote strategy settings can be updated (#49772)
- [x] de5eb04f050 Silence lint warnings in server project - part 2 (#49728)
- [x] 8c165e04a1c Replicate write actions before fsyncing them (#49746)
- [x] 944c681680d Make Snapshot Metadata Javadocs Clearer (#49697)
- [x] f8e39d2ff18 New setting to prevent automatically importing dangling indices (#49174)
- [x] 3ad8aa6d465 Remove obsolete resolving logic from TRA (#49685)
- [x] 602e589235d fix mis typo (#49689)
- [s] a354c607228 Revert "Remove obsolete resolving logic from TRA (#49647)"
- [s] 6cca2b04fa0 Remove obsolete resolving logic from TRA (#49647)
- [x] 4b16d50cd4b Fix typo when assigning null_value in GeoPointFieldMapper  (#49645)
- [x] 93dc8941d44 Strengthen validateClusterFormed check (#49248)
- [x] ba5b4f14131 ESIntegTestCase always cleans up static fields (#49105)
- [x] 5ba4f5fb3c9 Use dynamic port ranges for ExternalTestCluster (#45601)
- [x] 29235a637f7 Wait for events in waitForRelocation (#45074)
- [x] 42a331c59ba Remove Unused Features Field on StreamOutput (#44667)
- [x] f20414dd7d9 Optimize some StreamOutput Operations (#44660)
- [x] f00b658130d Remove RemoteClusterConnection.ConnectedNodes (#44235)
- [x] 433b3458522 Fix port range allocation with large worker IDs (#44213)
- [x] c40b77b771b Simplify port usage in transport tests (#44157)
- [x] 45b8aca6203 Some Cleanup in Test Framework (#44039)
- [x] 3166f7b836c Use unique ports per test worker (#43983)
- [x] 25792d31321 Remove nodeId from BaseNodeRequest (#43658)
- [x] aa12af8a3c4 Enable node roles to be pluggable (#43175)
- [x] 4fd7a22fcfd Allow cluster access during node restart (#42946)
- [x] bc008d8a9db Increase waiting time when check retention locks (#42994)
- [x] fe1674174f6 Remove some leftover refs to minimum_master_nodes (#42700)
- [x] 1b6dc178388 Remove transport client from tests (#42457)
- [x] c1de8c29db2 Cluster state from API should always have a master (#42454)
- [x] 328ba09f84b Omit non-masters in ClusterFormationFailureHelper (#41344)
- [x] 2f41b1b64de Remove `Tracer` from `MockTransportService` (#40237)
- [x] 7624734f14b Added wait_for_metadata_version parameter to cluster state api (#35535)
- [x] ebb93db0102 Remove pre 6.0.0 support from InternalEngine (#27720)

Below lists deferred patches. In-between patches that we applied or skipped
are not listed anymore.

- [d] c2deb287f13 Add a cluster setting to disallow loading fielddata on _id field (#49166)
- [d] 725dda37ea5 Flush instead of synced-flush inactive shards (#49126) -- CrateDB 5.0
- [d] b8ce07b4cc5 Pre-sort shards based on the max/min value of the primary sort field (#49092)
- [d] 4d659c4bdbf Make Repository.getRepositoryData an Async API (#49299)
- [d] a5f17fc2750 Add preflight check to dynamic mapping updates (#48817)
- [d] 2e7d62c27c9 Geo: improve handling of out of bounds points in linestrings (#47939)
- [d] 54d6da54320 [Java.time] Calculate week of a year with ISO rules (#48209)
- [d] 694373294fe Allow truncation of clean translog (#47866)
- [d] e3adedf610d Geo: implement proper handling of out of bounds geo points (#47734)
- [d] f9cb29450ec Geo: Fixes indexing of linestrings that go around the globe (#47471)
- [d] 8585d58b767 Provide better error when updating geo_shape field mapper settings (#47281)
- [d] 65374c9c010 Tidy up Store#trimUnsafeCommits (#47062)
- [d] 4ab71116688 Geo: fix indexing of west to east linestrings crossing the antimeridian (#46601)
- [d] fab31abbcc0 Log deprecation warning if es.transport.cname_in_publish_address property is specified (#45662)
- [d] e0a2558a4c3 transport.publish_address should contain CNAME (#45626)
- [d] 13a8835e5a8 Geo: Change order of parameter in Geometries to lon, lat (#45332)
- [d] 245cb348d35 Add per-socket keepalive options (#44055)
- [d] b07310022d2 [SPATIAL] New ShapeFieldMapper for indexing cartesian geometries (#44980)
- [d] 7e627d27e5c Geo: move indexShape to AbstractGeometryFieldMapper.Indexer (#44979)
- [d] 94b684630c8 [GEO] Refactor DeprecatedParameters in AbstractGeometryFieldMapper (#44923)
- [d] f603f06250a Geo: refactor geo mapper and query builder (#44884)
- [d] 321c2b86270 Force Merge should reject requests with `only_expunge_deletes` and `max_num_segments` set (#44761)
- [d] fd54e3e8244 Remove support for old translog checkpoint formats (#44272)
- [d] c8ae530e7a6 Don't use index_phrases on graph queries (#44340)
- [d] 33ad7928fbb Geo: extract dateline handling logic from ShapeBuilders (#44187)
- [d] e28fb1f0658 Fix index_prefix sub field name on nested text fields (#43862)
- [d] 56a662ed288 Remove Support for VERSION_CHECKPOINTS Translogs (#42782)
- [d] 6e39433cd53 Remove "nodes/0" folder prefix from data path (#42489)
- [d] c459ea828f6 Remove node.max_local_storage_nodes (#42428)
- [d] 3af0c1746b3 Expose external refreshes through the stats API (#38643)
- [d] ef18d3fb5b2 Add analysis modes to restrict token filter use contexts (#36103)
