======================================
Backporting changes from Elasticsearch
======================================

With CrateDB 4.0.0, we integrated the Elasticsearch code and then pruned out
everything we don't use.

With CrateDB 4.2.0, we changed the module structure so that Elasticsearch and
CrateDB code is no longer split, but mixed within the same modules. The
majority is in the ``server`` component.

We still want to keep many of the components up-to-date, while other
components will converge more and more over time.

The areas where we want to stay close to upstream Elasticsearch are mostly:

- Engine
- Snapshotting
- Recovery
- Discovery and master election


Applied changesets
==================

Patches should be applied in order. A backport commit message should be
prefixed with ``bp:``. This allows us to verify later on whether a patch was
applied using something like this::

    sh$ git log --oneline --grep 'bp:'


If a patch is skipped, use the ``sp:`` prefix instead.

To see if there are new changes, you can use ``git log`` in the Elasticsearch
repository. For example::

    git log --oneline 48d31194c25.. -- \
      server/src/main/java/org/elasticsearch/index/{engine,snapshots,store,translog,shard,seqno,mapper,codec}/ \
      server/src/main/java/org/elasticsearch/indices/recovery/ \
      server/src/main/java/org/elasticsearch/transport

Here ``48d31194c25`` is the starting point, it shows any changes since then
thatvaffected files in the given folder.

(Note that there may be changes before ``48d31194c25`` that are missing.)

We should eventually bump the reference point once all patches have been
applied to a certain point.

Below lists the changesets that we applied. This should be updated whenever a
backport is made. If a patch is skipped because it is not applicable, it
should be crossed out as well.

- ``x`` to mark applied patches
- ``s`` for skipped patches if they are not applicable (for example, if the
  functionality is not present in CrateDB)
- ``d`` marks a delayed patch - a non-trivial change we should apply that
  does not affect too any components, so delaying it doesn't make applying
  other patches more difficult


- [ ] 1a31f9e332c Keep checkpoint file channel open across fsyncs (#61744)
- [ ] 03c3d6a339a Allow [null] values in [null_value] (#61798)
- [ ] 28cec563b1a Allocate newly created indices on data_hot tier nodes (#61342)
- [ ] 1f8dd4dd6a8 Use int for number of parts in blob store (#61618)
- [ ] 462e25f9bba Pass SearchLookup supplier through to fielddataBuilder (#61430)
- [ ] 7adf766fc48 Search - add case insensitive support for regex queries. (#59441)
- [ ] 879279c9b46 Introduce point in time APIs in x-pack basic (#61062)
- [ ] c531574407c Speed up Compression Logic by Pooling Resources (#61358)
- [ ] 34b4acc8ad9 Migrate server mapper tests to new MapperTestCase (#61378)
- [ ] 051e79d27d5 Stop opening PING conns to remote clusters (#61408)
- [ ] 717db9c4ea7 Optimize a few Spots on IO Loop (#60865)
- [ ] dbd4fd02545 Convert NumberFieldMapper to parametrized form (#61092)
- [ ] 5457b343438 Correct how field retrieval handles multifields and copy_to. (#61309)
- [x] 98213df9462 Report more details of unobtainable ShardLock (#61255)
- [ ] 3b442743731 Improve 'ignore_malformed' handling for dates (#60211)
- [ ] 8e8d6f2ca2f Better error msg when CCS request on node without remote role (#60351)
- [ ] 2ef5902bfb0 Convert KeywordFieldMapper to parametrized form (#60645)
- [ ] b2a9466ab0e Handle nested arrays in field retrieval. (#60940)
- [ ] 8c51fc7e2d3 System index reads in separate threadpool (#57936)
- [ ] 3a81b110739 Make MetadataFieldMapper extend ParametrizedFieldMapper (#59847)
- [ ] 0e3f7c2fb27 Cut over IPFieldMapper to parametrized form (#60602)
- [ ] 04ca1913c57 Move distance_feature query building into MFT (#60614)
- [ ] fe780aae0bc Propagate forceExecution when acquiring permit (#60634)
- [ ] ec175d16537 Improve some BytesStreamOutput Usage (#60730)
- [ ] 9b71cdea7e3 Add recovery state tracking for Searchable Snapshots (#60505)
- [ ] d6fc439fef0 Move mapper validation to the mappers themselves (#60072)
- [ ] 598ed7222a3 Ignore shutdown when retrying recoveries (#60586)
- [ ] 85a30c06286 Improve deserialization failure logging (#60577)
- [ ] f3403faf127 Remove IndexFieldData#clear since it is unused. (#60475)
- [ ] 944a6c243c2 Allows nanosecond resolution in search_after (#60328)
- [ ] 48981b40424 Fix up BWC following backport of #60297 (#60313)
- [ ] 5d0f8e35656 Cleanup and optimize More Serialization Spots (#59959)
- [ ] 940d6181863 Log and track open/close of transport connections (#60297)
- [ ] b2b01dc6dee Properly document keepalive and other tcp options (#60216)
- [ ] 8a89d95372a Add search `fields` parameter to support high-level field retrieval. (#60100)
- [ ] 423bcd3c14d Remove typename validation (typename is always ) (#60133)
- [ ] 198b2d6654f ParametrizedFieldMapper to run validators against default value (#60042)
- [ ] 4ef33425d25 Wrap up building parametrized TypeParsers (#59977)
- [ ] 1cf9eac4045 Tweak toXContent implementation of ParametrizedFieldMapper (#59968)
- [ ] 98698f569d2 Drop some params from IndexFieldData.Builder (#59934)
- [ ] d4e315531ab Simplify structure for parsing points. (#59815)
- [ ] 6130ecc1731 Small cleanup for IndexFieldData (#59724)
- [ ] 42377c77299 Shortcut mapping update if the incoming mapping version is the same as the current mapping version (#59517)
- [ ] b9854165f34 Fix merge error
- [ ] bf12ac13333 Convert DateFieldMapper to parametrized format (#59429)
- [ ] 8bcca0c7a1d Preserve old serialization for CompletionFieldMapper (#59550)
- [ ] 678ae31d1d6 Fix compilation in Eclipse (#59675)
- [ ] fd88ab13419 Correct type parametrization in geo mappers. (#59583)
- [ ] b083bafa786 Make MappedFieldType#meta final (#59383)
- [ ] dc91a300700 Move getPointReaderOrNull into AggregatorBase (#58769)
- [ ] b87bb86d88d Adding indexing pressure stats to node stats API (#59247)
- [ ] 24786ac71b8 Migrate CompletionFieldMapper to parametrized format (#59291)
- [ ] 33630489dbf Continue to accept unused 'universal' params in <8.0 indexes (#59381)
- [ ] 40b9fd49e02 Make data streams a basic licensed feature. (#59293)
- [ ] 4c1b081e270 Fix estimate size of translog operations (#59206)
- [ ] 62f51eb9aec MappedFieldType no longer requires equals/hashCode/clone (#59212)
- [ ] 219b7dbd12f Add declarative parameters to FieldMappers (#58663)
- [ ] 5688e0e4900 Do not release safe commit with CancellableThreads (#59182)
- [ ] cb6b05d12b9 Fix the timestamp field of a data stream to @timestamp (#59076)
- [ ] 961db311f0e Sending operations concurrently in peer recovery (#58018)
- [ ] 31a569a60a2 Remove uid from translog delete operation (#59101)
- [ ] 2e3f3c0fce8 Extract recovery files details to its own class (#59039)
- [ ] 90e72a4194e Avoid flipping translog header version (#58866)
- [ ] 52ff121fcfc Re-enable support for array-valued geo_shape fields. (#58786)
- [ ] 673444000e3 Percolator keyword fields should not store norms (#58899)
- [ ] 001b3fb4406 Add data stream timestamp validation via metadata field mapper (#58582)
- [ ] 69c7e73b665 Drop rewriting in date_histogram (#57836)
- [ ] 3944066e992 Move MappedFieldType#getSearchAnalyzer and #getSearchQuoteAnalyzer to TextSearchInfo (#58639)
- [ ] dcd723a6b19 Enable BWC tests after backport of #58029 (#58815)
- [ ] ee79ae072ba Week based parsing for ingest date processor (#58597)
- [ ] 83d6589b2ae Account for remaining recovery in disk allocator (#58029)
- [ ] 118521d0223 Account for recovery throttling when restoring snapshot (#58658)
- [ ] 676893a2632 Merge mappings for composable index templates (#58521)
- [ ] 9bef31ccd3a Do not create two loggers for DeprecationLogger (#58435)
- [ ] 7d64b71a05d Simplify Serialization of ForceMergeRequest (#58470)
- [ ] c16a4553cb2 Add memory tracking to queued write operations (#57573)
- [ ] a914d84429a Introduce node.roles setting (#54998)
- [ ] cdc1be144bf Field capabilities - make `keyword` a family of field types (#58315)
- [ ] 83ce7a96915 Move MappedFieldType.similarity() to TextSearchInfo (#58439)
- [ ] 57316e26af6 Add text search information to MappedFieldType (#58230)
- [ ] 3cbe56463ed Make FieldTypeLookup immutable (#58162)
- [ ] 409306e01db Correct default formatting of binary fields (#58338)
- [ ] 708f6bf8795 Add serialization test for FieldMappers when include_defaults=true (#58235)
- [ ] 09ff747fe74 Remove Settings parameter from FieldMapper base class (#58237)
- [ ] 0c3dd945338 Add new extensions for Lucene86 points codec to FsDirectoryFactory (#58226)
- [ ] 1d62d7d663f Don't log on RetentionLeaseSync error handler (#58098)
- [ ] c7cbf80dfc9 Remove needless termsQuery implementation from StringFieldType (#57609)
- [ ] bf910e91328 Fix recovery stage transition with sync_id (#57754)
- [ ] 3b696828ada MappedFieldType should not extend FieldType (#57666)
- [ ] 79227e1413c Fix Running TranslogOps on CS Thread (#58056)
- [ ] 4263de790aa Hide AlreadyClosedException on IndexCommit release (#57986)
- [ ] e19a82d7628 Update to lucene snapshot e7c625430ed (#57981)
- [ ] e1065b24142 Fix Remote Recovery Being Retried for Removed Nodes (#57608)
- [ ] db584c07a2b Fix stalled send translog ops request (#57859)
- [ ] 8c8253d251f Minor Cleanup Dead Code Snapshotting (#57716)
- [ ] c095a3a2478 Assert on request headers only (#57792)
- [ ] 5221970b2ab Use clean thread context for transport and applier service (#57792)
- [ ] 1423a0c42eb Fix translog ops action name in channel listener (#57854)
- [ ] 807e0759ab3 Update version peer recovery constants to 7_9 (#57829)
- [ ] b68bd78a53a Refactor how to determine if a field is metafield (#57378)
- [ ] 3f072aabcb9 Restore ThreadContext after Serializing OutboundMessage (#57659)
- [ ] 88a2aeb8cf6 Remove the 'array value parser' marker interface. (#57571)
- [ ] 0a23487e73e IndexFieldData should hold the ValuesSourceType (#57373)
- [ ] 6477924c262 Store parsed mapping settings in IndexSettings (#57492)
- [ ] 4d6dc51c729 Header warning logging refactoring (#55941)
- [ ] 2ef82cd7f95 Fix Local Translog Recovery not Updating Safe Commit in Edge Case (#57350)
- [ ] 99871b18d64 Catch InputCoercionException thrown by Jackson parser (#57287)
- [ ] 86b64e4c39e Remove unused logic from FieldNamesFieldMapper. (#56834)
- [ ] 579ce2f99cb Reestablish peer recovery after network errors (#55274)
- [ ] fed71fbd669 Remove Mapper.updateFieldType() (#56986)
- [ ] 2787eadb1ac Flatten ReleaseableBytesReference Object Trees (#57092)
- [ ] 2a8b5787466 Serialize Outbound Messages on IO Threads (#56961)
- [ ] 65f3cb1f1f6 Close channel on handshake error with old version (#56989)
- [ ] 9a49075d0c9 Simplify range query methods for range types. (#56976)
- [ ] f82d74b5017 Move merge compatibility logic from MappedFieldType to FieldMapper (#56915)
- [ ] 0cc2345f98d Simplify generics on Mapper.Builder (#56747)
- [ ] 595ce8b5e37 Cancel task and descendants on channel disconnects (#56620)
- [ ] 9c7e0d4ddb2 Prevent connection races in testEnsureWeReconnect (#56654)
- [ ] 7b34e22890e Use index sort range query when possible. (#56657)
- [ ] 954afd94fe8 Clean up DocValuesIndexFieldData (#56372)
- [ ] e62fb090fa5 upgrade to Lucene 8.6.0 snapshot (#56175)
- [ ] 4de4c14b5b9 Save Bounds Checks in BytesReference (#56577)
- [ ] a01d2bd24b0 [Geo] Refactor Point Field Mappers (#56060)
- [ ] fa535d08b50 Use CollectionUtils.isEmpty where appropriate (#55910)
- [ ] e1dbe2606ce Use snapshot information to build searchable snapshot store MetadataSnapshot (#56289)
- [ ] a95586773fd Improve logging around SniffConnectionStrategy (#56292)
- [ ] 601617a3fc0 Avoid copying file chunks in peer covery (#56072)
- [ ] 77ac5d805bb Make sure to use ParseContext.Document#addAll when possible.
- [ ] 7a5d18ddc37 Simplify signature of FieldMapper#parseCreateField. (#56066)
- [ ] bb04fbcd969 For constant_keyword, make sure exists query handles missing values. (#55757)
- [ ] b2b32d7cf85 Retry failed replication due to transient errors (#55633)
- [ ] a508d3303d5 Ensure no circular reference in translog tragic exception (#55959)
- [ ] b22a5288f57 Fix NullPointer when message shortcircuited (#55882)
- [ ] 8d276043667 Improve RemoteConnectionManager consistency (#55759)
- [ ] d7bc3ddf056 Fix Leaking Listener When Closing NodeClient (#55676)
- [ ] 8521ae52b1b Remove TODO around aggregating on _index.
- [ ] db288a29ec9 Ignore closed exception on refresh pending location listener (#55799)
- [ ] b2a15c62fb2 Return true for can_match on idle search shards (#55428)
- [ ] 43b8327b6e0 [Geo] fix GeoShapeWithDocValuesFieldMapper.doXContentBody
- [ ] eb0b2c8f699 Refactor Spatial Field Mappers (#55621)
- [ ] 4ed0dc8703f Retry failed peer recovery due to transient errors (#55353)
- [ ] d6fb306c961 Allow searching of snapshot taken while indexing (#55511)
- [ ] 05066aecf07 Add Bulk stats track the bulk per shard (#52208)
- [ ] c2df6f911d1 Ensure not to open directory reader on transport thread (#55419)
- [ ] 5216bd273a7 Retry follow task when remote connection queue full (#55314)
- [ ] b78dfb07ae1 Add geo_shape mapper supporting doc-values in Spatial Plugin (#55037)
- [ ] 5c66caf21a9 Fix updating include_in_parent/include_in_root of nested field throwsâ€¦ (#54386)
- [ ] 8638d08ebf6 Always use deprecateAndMaybeLog for deprecation warnings (#55115)
- [ ] b54ee89511d Introduce mechanism to stub request handling (#55091)
- [ ] 633790fa99f NodeInfo response should use a collection rather than fields (#54460)
- [ ] dd72ccbe277 Fail sniff  process if no connections opened (#54934)
- [ ] 4f0ccd3c254 Implement transport circuit breaking in aggregator (#54610)
- [ ] 3bfcc60cce6 Update translog policy before the next safe commit (#54839)
- [ ] f6feb6c2c84 Merge feature/searchable-snapshots branch into master (#54803)
- [ ] 2c5951ae1cf Use TransportChannel in TransportHandshaker (#54684)
- [ ] 150065182eb Disallow changing 'enabled' on the root mapper. (#54463)
- [ ] 139931af5b2 Revert sending cluster name and node in handshake (#54661)
- [ ] ee3d40320aa Broadcast cancellation to only nodes have outstanding child tasks (#54312)
- [ ] 95a7eed9aa3 Rename MetaData to Metadata in all of the places (#54519)
- [ ] 9d861bff71e Move network stats marking into InboundPipeline (#54393)
- [ ] 6fcb51dafcd Fix issue with pipeline releasing bytes early (#54458)
- [ ] 42150d36740 Move transport decoding and aggregation to server (#48263)
- [ ] a90c1de8745 Add ValuesSource Registry and associated logic (#54281)
- [ ] e9bc3e8234b Disallow negative TimeValues (#53913)
- [ ] 513985e0722 Remove the cluster.remote.connect setting (#54175)
- [ ] f301f499184 Avoid I/O operations when rewriting shard search request (#54044)
- [ ] 1fc0432b244 Introduce formal role for remote cluster client (#53924)
- [ ] 2f9e5fa9cea Allow proxy mode server name to be updated (#54107)
- [ ] 2537e02a7db Wildcard field - add normalizer support (#53851)
- [ ] c5d073185e8 Give helpful message on remote connections disabled (#53690)
- [ ] ec4c699defb Prevent SigTerms/SigText from running on fields they do not support (#52851)
- [ ] 8264bdd36a2 Revert "Introduce system index APIs for Kibana (#52385)" (#53912)
- [ ] 87c910b36f8 Better Incrementality for Snapshots of Unchanged Shards (#52182)
- [ ] 856721c574d Handle properly indexing rectangles that crosses the dateline (#53810)
- [ ] 2794ab79753 Execute retention lease syncs under system context (#53838)
- [ ] 6eb698bc6d3 Add support for distance queries on geo_shape queries (#53466)
- [ ] d1cbdfb7530 Geo shape query vs geo point (#52382)
- [ ] e1096b9457c Restore off-heap loading for term dictionary in ReadOnlyEngine (#53713)
- [ ] 3e607d9e93c Rename AtomicFieldData to LeafFieldData (#53554)
- [ ] 41e3b4aa905 Invoke response handler on failure to send (#53631)
- [ ] 87dc720daca Update server name serialization version
- [ ] 2abf40a6b61 Add server name to remote info API (#53634)
- [ ] 01eee1a97f9 Highlighters skip ignored keyword values (#53408)
- [ ] 8ccdaa3a354 Align remote info api with new settings (#53441)
- [ ] 1fc3fe3d32f Fix Term Vectors with artificial docs and keyword fields (#53504)
- [ ] facd525b0a3 Mask wildcard query special characters on keyword queries (#53127)
- [ ] 352e59cc56f Fix doc_stats and segment_stats of ReadOnlyEngine (#53345)
- [ ] 713e931df4c Record Force Merges in Live Commit Data (#52694)
- [ ] a63232d2bc6 Fix date_nanos in composite aggs (#53315)
- [ ] 5d716bc16ce Upgrade to final lucene 8.5.0 snapshot (#53293)
- [ ] abdaf3ab2c5 Use given executor for global checkpoint listener (#53260)
- [ ] 04930e990aa Notify refresh listeners on the calling thread (#53259)
- [ ] 806046339d2 Early return if no global checkpoint listeners (#53036)
- [ ] 4c0e8f12cbc Introduce system index APIs for Kibana (#52385)
- [ ] f4223b6a8fa Add size support to `top_metrics` (#52662)
- [ ] 31b29875c9d Add validation for dynamic templates (#51233)
- [ ] 4943bc0cd39 HybridDirectory should mmap postings. (#52641)
- [ ] a3a98c7003e Cache completion stats between refreshes (#51991)
- [ ] c5ed349382c Fix RemoteConnectionManager size() method (#52823)
- [ ] 94f5accfed8 Remove seeds depedency for remote cluster settings (#52796)
- [ ] 8830eb6b9a8 Generalize how queries on `_index` are handled at rewrite time (#52486)
- [ ] 18f5e5a3709 Update RemoteConnectionInfo version constants (#52780)
- [ ] a789f74b769 Fix incorrect indentation in TextFieldMapper.
- [ ] 7684ae882c8 Improve the error message when loading text fielddata. (#52753)
- [ ] 2a95ecb7c18 Don't index ranges including NOW in percolator (#52748)
- [ ] f05b831e43a Comprehensively test supported/unsupported field type:agg combinations (#52493)
- [ ] 16af0472a98 Separate translog from index deletion conditions (#52556)
- [ ] cbd224d0701 Upgrade Lucene 8.5 to latest snapshot (#52520)
- [ ] b176cca607e Fix synchronization in ByteSizeCachingDirectory (#52512)
- [ ] f3b5bd951b0 Move the terms index of `_id` off-heap. (#52405)
- [ ] 30316d6d640 Refactor GeoShapeIndexer by extracting polygon / line decomposers (#52422)
- [ ] 403d1ff7008 Optimize FilterStreamInput for Network Reads (#52395)
- [ ] 5b2266601be Implement top_metrics agg (#51155)
- [ ] a8b39ed842c Add a cluster setting to disallow expensive queries (#51385)
- [ ] da2b67d6e5b Fix a DST error in date_histogram (#52016)
- [ ] 2c305810cc6 In FieldTypeLookup, factor out flat object field logic. (#52091)
- [ ] eb56c271b4c Don't Upload Redundant Shard Files (#51729)
- [ ] ebc46814732 Use local checkpoint to calculate min translog gen for recovery (#51905)
- [ ] 19174d6ef0d Cleanup some Dead Code in o.e.index.store (#52045)
- [ ] f38a4f5b9ad Remove references to mapping type in FieldTypeLookup. (#52026)
- [ ] e0b3ea04167 Rename MapperService#fullName to fieldType. (#52025)
- [ ] e79e6d9c1d0 Remove Redundant Loading of RepositoryData during Restore (#51977)
- [ ] 3c9996404f4 Remove the index.mapper.dynamic setting. (#51718)
- [ ] 26b9cf787df Add Trace Logging of REST Requests (#51684)
- [ ] eb69c6fe7cf Always rewrite search shard request outside of the search thread pool (#51708)
- [ ] 7e85fc454eb Throw better exception on wrong `dynamic_templates` syntax (#51783)
- [ ] 84dd9dc9c03 Add host address to BindTransportException message (#51269)
- [ ] bf317e8c4eb Remove comparison to true for booleans (#51723)
- [ ] 9dbd9ba757f Extract a ConnectionManager interface (#51722)
- [ ] 7cec5f93bee Make `date_range` query rounding consistent with `date` (#50237)
- [ ] 336a3958aa6 Log exceptions in TcpTransport at DEBUG level (#51612)
- [ ] c117c0cf0a2 Password-protected Keystore Feature Branch PR (#51123)
- [ ] 0c87892b3db Remove sync flush logic in Engine (#51450)
- [ ] b034d1e2ef8 Remove translog retention policy (#51417)
- [ ] 80cacc617f2 Enable operation-based recoveries for old copies (#51380)
- [ ] 5132715bc10 Do not wrap soft-deletes reader for segment stats (#51331)
- [ ] 151148622cb Exclude nested documents in LuceneChangesSnapshot (#51279)
- [ ] 1dc9dd42235 Add NestedPathFieldMapper to store nested path information (#51100)
- [ ] fac1247e16f Fix Overly Optimistic Request Deduplication (#51270)
- [ ] 573c7ddab18 Remove fieldMapper parameter from MetadataFieldMapper.TypeParser#getDefault() (#51219)
- [ ] 6e2f7b4b084 Use Lucene index in peer recovery and resync (#51189)
- [ ] c8e9f57348f Account soft-deletes in FrozenEngine (#51192)
- [ ] 3d796248437 Revert "Don't use user-supplied type when building DocumentMapper (#50960)" (#51214)
- [ ] 9bb7d21c0b0 Remove the AllFieldMapper from master (#51106)
- [ ] 09b46c86463 Goodbye and thank you synced flush! (#50882)
- [ ] b332c8b0f5d Revert "Update handshake response version constants to 7.6 (#48917)" (#50945)
- [ ] 774bfb5e223 Don't use user-supplied type when building DocumentMapper (#50960)
- [ ] 5736dfb8c31 Warn on slow metadata performance (#50956)
- [ ] d1deeaeb74c Allow proxy mode server name to be configured (#50774)
- [ ] d9528406bf3 Use default profile for remote connections (#50828)
- [ ] a0513217dba Move metadata storage to Lucene (#50907)
- [ ] 0510af87868 Do not force refresh when write indexing buffer (#50769)
- [ ] fdd413370ef Deleted docs disregarded for if_seq_no check (#50526)
- [ ] 4c1f1b2acab Declare remaining parsers `final` (#50571)
- [ ] 424ed93e38b Always use soft-deletes in InternalEngine (#50415)
- [ ] d02afccd983 Ensure relocating shards establish peer recovery retention leases (#50486)
- [ ] 50bd5842c3c Fix testCancelRecoveryDuringPhase1 (#50449)
- [ ] 5e0030e1306 Adjust BWC for peer recovery retention leases (#50351)
- [ ] a48d19d73a8 Add remote info to the HLRC (#50482)
- [ ] b7ac7324d23 Revert "Add remote info to the HLRC (#49657)"
- [ ] f4989c54c45 Revert "serialize initial_connect_timeout as xcontent correctly"
- [ ] ae64eaabdae serialize initial_connect_timeout as xcontent correctly
- [ ] fa1a7c57b8e Add remote info to the HLRC (#49657)
- [ ] cec6678587e Use peer recovery retention leases for indices without soft-deletes (#50351)
- [ ] 3b8f5d9ea18 Modify proxy mode to support a single address (#50391)
- [ ] 342a2920a96 Rename the remote connection mode simple to proxy (#50291)
- [ ] 2d627ba7574 Add per-field metadata. (#49419)
- [ ] 012746dd816 Send hostname in SNI header in simple remote mode (#50247)
- [ ] 74ff50f814a Omit loading IndexMetaData when inspecting shards (#50214)
- [ ] 7b863dc25b3 Recovery buffer size 16B smaller (#50100)
- [ ] 972b81f8a9d Account trimAboveSeqNo in committed translog generation (#50205)
- [ ] 34f83904cc8 Adjust bwc for #48430
- [ ] b9fbc8dc748 Migrate peer recovery from translog to retention lease (#49448)
- [ ] 0cedb9e2517 Update remote cluster stats to support simple mode (#49961)
- [ ] 70af176dea3 Improve DateFieldMapper `ignore_malformed` handling (#50090)
- [ ] c5ecbee224f Update TcpHeader version constant for backport (#50086)
- [ ] 1329acc094c Upgrade to lucene 8.4.0-snapshot-662c455. (#50016)
- [ ] 87517d96f62 Enable dependent settings values to be validated (#49942)
- [ ] fc3454b10bb Randomly run CCR tests with _source disabled (#49922)
- [ ] 7f1e1c51a47 Cleanup some in o.e.transport (#49901)
- [ ] 8c2dda90c0f Add int indicating size of transport header (#48884)
- [ ] fb293adb0f5 Ensure remote strategy settings can be updated (#49772)
- [ ] de5eb04f050 Silence lint warnings in server project - part 2 (#49728)
- [ ] 944c681680d Make Snapshot Metadata Javadocs Clearer (#49697)
- [ ] 3ad8aa6d465 Remove obsolete resolving logic from TRA (#49685)
- [ ] 602e589235d fix mis typo (#49689)
- [ ] a354c607228 Revert "Remove obsolete resolving logic from TRA (#49647)"
- [ ] 6cca2b04fa0 Remove obsolete resolving logic from TRA (#49647)
- [ ] 4b16d50cd4b Fix typo when assigning null_value in GeoPointFieldMapper  (#49645)
- [ ] c2deb287f13 Add a cluster setting to disallow loading fielddata on _id field (#49166)
- [ ] 563b2736a9f Annotated text type should extend TextFieldType (#49555)
- [ ] 7069045cd42 Add the simple strategy to cluster settings (#49414)
- [ ] 725dda37ea5 Flush instead of synced-flush inactive shards (#49126)
- [ ] b8ce07b4cc5 Pre-sort shards based on the max/min value of the primary sort field (#49092)
- [ ] 7754e626ce7 Use retention lease in peer recovery of closed indices (#48430)
- [ ] 4ac79f900dd Verify translog checksum before UUID check (#49394)
- [ ] 8e2a23aa0aa make dim files mmapped (#49272)
- [ ] 4f4140431b8 Allow simple connection strategy to be configured (#49066)
- [ ] 4d659c4bdbf Make Repository.getRepositoryData an Async API (#49299)
- [ ] 0260c6f55c4 ThreadPool and ThreadContext are not closeable (#43249)
- [ ] 5aa5d7b54b9 Ignore Lucene index in peer recovery if translog corrupted (#49114)
- [ ] 0f6ffc20a53 Refactor percolator's QueryAnalyzer to use QueryVisitors (#49238)
- [ ] c1c7fa5d9c8 Remove type field from internal PutMappingRequest (#48793)
- [ ] 66f49d8ea5d Always use primary term from primary to index docs on replica (#47583)
- [ ] fbaf8c428d7 Fix Transport Stopped Exception (#48930)
- [ ] 7559bab501f MapperService.merge() should take a single mapper rather than a map (#48954)
- [ ] 293648b4ee7 [#40366] Silence some lint warnings in server project (#48927)
- [ ] 77a8bc3cd1e Update handshake response version constants to 7.6 (#48917)
- [x] 79625fe6940 Remove Uid as an instantiable class (#48801)
- [ ] 47b49251eae Improve resiliency to auto-formatting in server (#48450)
- [ ] 01030caf8e4 Allow realtime get to read from translog (#48843)
- [ ] a0e3e943817 Send cluster name and discovery node in handshake (#48906)
- [ ] d029e18c722 Closed shard should never open new engine (#47186)
- [ ] 3ce7a37f1ff Remove index.force_memory_term_dictionary setting (#48873)
- [ ] e0469a72199 Remove support for ancient corrupted markers (#48858)
- [ ] a5f17fc2750 Add preflight check to dynamic mapping updates (#48817)
- [ ] be6697f05a9 Remove Blocking Connect Methods from TransportService (#48841)
- [ ] 6742d9c9d90 Cleanup Redundant Futures in Recovery Code (#48805)
- [ ] 4c75564bd13 Return consistent source in updates (#48707)
- [ ] 927cc34eca9 Do not warm up searcher in engine constructor (#48605)
- [ ] e58fc03d42f Restore from Individual Shard Snapshot Files in Parallel (#48110)
- [x] dbd33f77643 Remove type parameter from MapperService.documentMapper() (#48593)
- [x] 4b89171e6f1 Fix ref count handling in Engine.failEngine (#48639)
- [x] 4e81ae74b2e Remove deprecated IndexMetaData.getMappings() method (#47344)
- [x] 71a6873e892 Greedily advance safe commit on new global checkpoint (#48559)
- [x] 5297e5afa0b Add a new merge policy that interleaves old and new segments on force merge (#48533)
- [x] 379e8470488 Refresh should not acquire readLock (#48414)
- [s] 0600e658781 Make remote setting updates support diff strategies (#47891)
- [d] 2e7d62c27c9 Geo: improve handling of out of bounds points in linestrings (#47939)
- [d] 54d6da54320 [Java.time] Calculate week of a year with ISO rules (#48209)
- [x] 8066e23eea3 Use MultiFileTransfer in CCR remote recovery (#44514)
- [x] 458de912561 Make BytesReference an interface (#48171)
- [x] 6563c0fb7b2 Remove Redundant Version Param from Repository APIs (#48231)
- [s] 602081f19cf [DOCS] Fix typos in InternalEngine.java comments (#46861)
- [x] e14300e8e5d Remove followup reroute priority setting (#44611)
- [x] 51fb95ef83f Defer reroute when starting shards (#44433)
- [x] 704317da71c Remove Support for pre-5.x Indices in Restore (#48181)
- [x] 6531369f11d Don't persist type information to translog (#47229)
- [s] d6d9fc5881c Don't apply the plugin's reader wrapper in can_match phase (#47816)
- [x] e628f35f69b Sequence number based replica allocation (#46959)
- [x] d8f5a3d647a Avoid unneeded refresh with concurrent realtime gets (#47895)
- [d] 694373294fe Allow truncation of clean translog (#47866)
- [s] 566e1b7d33e Remove type field from DocWriteRequest and associated Response objects (#47671)
- [x] f749bacf34b Sync translog without lock before trim unreferenced readers (#47790)
- [x] c74527e4bb4 Simplify some Common ActionRunnable Uses (#47799)
- [d] e3adedf610d Geo: implement proper handling of out of bounds geo points (#47734)
- [d] f9cb29450ec Geo: Fixes indexing of linestrings that go around the globe (#47471)
- [s] 98611e77cc9 Introduce simple remote connection strategy (#47480)
- [s] c26ce1d7f52 DocValueFormat implementation for date range fields (#47472)
- [x] 8c464775663 Limit number of retaining translog files for peer recovery (#47414)
- [x] 29463551aea Remove typename checks in mapping updates (#47347)
- [x] 9993cf391f1 Use standard semantics for retried auto-id requests (#47311)
- [d] 8585d58b767 Provide better error when updating geo_shape field mapper settings (#47281)
- [s] 50e0c96f3f4 Extract remote "sniffing" to connection strategy (#47253)
- [x] c048c86351b Allow optype CREATE for append-only indexing operations (#47169)
- [s] 237b238a769 Remove `type` query (#47207)
- [x] ff99bc1d3f8 Remove per-type indexing stats (#47203)
- [x] 2b8c7c5e11c Remove write lock for Translog.getGeneration (#47036)
- [x] b1a03a137fd Remove unused private methods and fields (#47115)
- [x] 632855885e7 Extract proxy connection logic to specialized class (#46898)
- [x] 9df6cbef9e4 Remove isRecovering method from Engine (#47039)
- [d] 65374c9c010 Tidy up Store#trimUnsafeCommits (#47062)
- [x] b269a77ccf5 Remove ensureIndexHasHistoryUUID (#47043)
- [s] b6454e978e1 Reject regexp queries on the _index field. (#46945)
- [x] f6fe55fa60d Remove locking around connection attempts (#46845)
- [x] f11a3c22298 Track Shard Snapshot Generation in CS (#46864)
- [s] 2351aa3efbd Disallow `_field_names` enabled setting (#46681)
- [s] 127b8d03642 Add support for aliases in queries on _index. (#46640)
- [s] ba9940b7c4c Reduce a bind failure to trace logging (#46891)
- [x] 6a5bae184b8 Remove default mapping (#44945)
- [s] 7c90801aff3 Remove types from Get/MultiGet (#46587)
- [x] dffaefeed44 Remove Duplicate Shard Snapshot State Updates (#46862)
- [x] ff9e8c62242 Remove ExceptionHelper.detailedMessage (#45878)
- [s] c01f58aac9e Remove docs for proxy mode (#46677)
- [x] b52c2d5d82a Handle lower retaining seqno retention lease error (#46420)
- [d] 4ab71116688 Geo: fix indexing of west to east linestrings crossing the antimeridian (#46601)
- [s] d0a7bbcb694 Deprecate `_field_names` disabling (#42854)
- [x] 41d3eb31946 Revert "Sync translog without lock when trim unreferenced readers (#46203)"
- [x] b38f4644038 Do not send recovery requests with CancellableThreads (#46287)
- [x] fd8183ee51d Sync translog without lock when trim unreferenced readers (#46203)
- [x] 12a4177690e Wait for all Rec. to Stop on Node Close (#46178)
- [x] 911d02b7a9c Enhanced logging when transport is misconfigured to talk to HTTP port (#45964)
- [x] cb2e7325992 Flush engine after big merge (#46066)
- [x] a2d4b81b6b5 Handle delete document level failures (#46100)
- [x] 32514665969 Handle no-op document level failures (#46083)
- [x] 54ccdc7e9ad Do not create engine under IndexShard#mutex (#45263)
- [s] 1a0dddf4ad2 Range Field support for Histogram and Date Histogram aggregations(#45395)
- [s] 4f52ebd32eb Better logging for TLS message on non-secure transport channel (#45835)
- [x] 18282b0f2b0 Update translog checkpoint after marking ops as persisted (#45634)
- [s] 23673a1eaa0 Fix RemoteClusterConnection close race (#45898)
- [x] 9f654fd67ef Fsync translog without writeLock before rolling (#45765)
- [d] fab31abbcc0 Log deprecation warning if es.transport.cname_in_publish_address property is specified (#45662)
- [x] 0fb695e2e44 Never release store using CancellableThreads (#45409)
- [x] 1bcda083683 Rename PlainTransportFuture -> TransportFuture (#45768)
- [x] 4d210dda02d Remove index-N Rebuild in Shard Snapshot Updates (#45740)
- [x] 60247d31728 Remove Blocking Transport APIs (#45756)
- [x] b0d346fd742 Ignore translog retention policy if soft-deletes enabled (#45473)
- [s] 8930f7fbf76 Remove support for string in unmapped_type. (#45675)
- [d] e0a2558a4c3 transport.publish_address should contain CNAME (#45626)
- [x] 6e7ede43fb7 Lower Limit for Maximum Message Size in TcpTransport (#44496)
- [s] 84f0587a530 Cleanup Redundant TransportLogger Instantiation (#43265)
- [s] abb30f0f814 Make sure to validate the type before attempting to merge a new mapping. (#45157)
- [s] d1065fed2b1 Adjust BWC version for #44756
- [d] 13a8835e5a8 Geo: Change order of parameter in Geometries to lon, lat (#45332)
- [x] 8d1ea865197 Set start of the week to Monday for root locale (#43652)
- [x] fd4acb3e8b7 Only retain reasonable history for peer recoveries (#45208)
- [x] c26f850c443 Call afterWriteOperation after trim translog in peer recovery (#45182)
- [d] 245cb348d35 Add per-socket keepalive options (#44055)
- [x] 6bb6927151c Remove assertion after locally recover replica (#45181)
- [s] 5ec6ad38649 Fix BWC for fileBasedRecovery flag removal (#45185)
- [x] 302d29c8705 Trim local translog in peer recovery (#44756)
- [x] 6215f98fa68 Remove fileBasedRecovery flag (#45131)
- [x] 01287eacb2f Use index for peer recovery instead of translog (#45136)
- [x] 3c352a85963 Make setting index.translog.sync_interval be dynamic (#37382))
- [x] c4b831645cb MINOR: Remove some deadcode in NodeEnv and Related (#34133)

Below lists deferred patches. In-between patches that we applied or skipped
are not listed anymore.

- [d] b07310022d2 [SPATIAL] New ShapeFieldMapper for indexing cartesian geometries (#44980)
- [d] 7e627d27e5c Geo: move indexShape to AbstractGeometryFieldMapper.Indexer (#44979)
- [d] 94b684630c8 [GEO] Refactor DeprecatedParameters in AbstractGeometryFieldMapper (#44923)
- [d] f603f06250a Geo: refactor geo mapper and query builder (#44884)
- [d] 321c2b86270 Force Merge should reject requests with `only_expunge_deletes` and `max_num_segments` set (#44761)
- [d] fd54e3e8244 Remove support for old translog checkpoint formats (#44272)
- [d] c8ae530e7a6 Don't use index_phrases on graph queries (#44340)
- [d] 33ad7928fbb Geo: extract dateline handling logic from ShapeBuilders (#44187)
- [d] e28fb1f0658 Fix index_prefix sub field name on nested text fields (#43862)

- [d] 56a662ed288 Remove Support for VERSION_CHECKPOINTS Translogs (#42782)
- [d] 6e39433cd53 Remove "nodes/0" folder prefix from data path (#42489)
- [d] c459ea828f6 Remove node.max_local_storage_nodes (#42428)
- [d] 3af0c1746b3 Expose external refreshes through the stats API (#38643)
- [d] ef18d3fb5b2 Add analysis modes to restrict token filter use contexts (#36103)
